stages:
  - deploy

deploy-job:
  stage: deploy
  script:
    - rsync -av --delete --exclude .git --exclude static --exclude media ./ "$HOME/private/ci/$CI_COMMIT_BRANCH"
    - cd "$HOME/private/ci/$CI_COMMIT_BRANCH"
    - poetry install
    - poetry run ./manage.py migrate --no-input
    - poetry run ./manage.py --no-input
  rules:
    - if: $CI_PIPELINE_SOURCE == "push"
